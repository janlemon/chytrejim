<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>chyt≈ôejim.cz ‚Äì Today Mock</title>
  <style>
    :root{
      --bg:#F7F8FA;--card:#FFFFFF;--text:#0F172A;--subtext:#475569;--muted:#64748B;--border:#E5E7EB;--accent:#FACC15;--error:#EF4444;--radius:16px;--shadow:0 1px 2px rgba(0,0,0,.06)
    }
    @media (prefers-color-scheme: dark){
      :root{--bg:#0B0F13;--card:#0F141A;--text:#EEF2F7;--subtext:#9AA4B2;--muted:#7A8594;--border:#1F2A37;--accent:#FACC15;--error:#F87171;--shadow:none}
    }
    *{box-sizing:border-box} html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font:16px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
    .phone{max-width:420px;margin:0 auto;padding:16px 16px 24px}
    header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:12px}
    .hi{font-weight:600;font-size:20px}
    .date{color:var(--muted);font-size:14px;margin-top:2px}
    .icon-btn{background:transparent;border:0;padding:8px;border-radius:10px}
    .icon-btn:hover{background:rgba(0,0,0,.04)}
    @media (prefers-color-scheme: dark){.icon-btn:hover{background:rgba(255,255,255,.06)}}

    .card{background:var(--card);border:2px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin-top:16px}
    .card h2{margin:0 0 8px;font-size:18px;font-weight:700}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .muted{color:var(--muted)}
    .sub{color:var(--subtext)}
    .link{color:#b58900;color:var(--text)}
    .accent{color:#3d3d3d}
    .accent-link{color:#b45309}

    /* Donut */
    .donut-wrap{display:flex;justify-content:center;align-items:center;margin-top:4px;}
    .donut{position:relative;width:180px;height:180px}
    .donut svg{transform:rotate(-90deg)}
    .donut .center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center}
    .center .big{font-weight:700;font-size:22px}
    .center .small{font-size:12px;color:var(--muted)}
    .legend .item{display:flex;justify-content:space-between;gap:12px;margin:6px 0}
    /* legend removed in favor of stacked breakdown */
    @media (max-width: 420px){
      .donut-wrap{ }
    }

    /* Breakdown under donut */
    .energy-breakdown{margin-top:14px;border-top:1px solid var(--border);padding-top:12px;display:grid;row-gap:10px}
    .energy-breakdown .item{display:flex;justify-content:space-between;align-items:baseline;gap:12px}
    .energy-breakdown .item strong{font-weight:700;font-size:18px}
    @media (max-width:420px){.energy-breakdown .item strong{font-size:16px}}

    @media (max-width: 420px){
      .donut-wrap{grid-template-columns:1fr}
      .legend{border-left:none;padding-left:0;margin-top:8px}
    }

    /* Bars */
    .bar{height:12px;background:var(--border);border-radius:999px;overflow:hidden}
    .bar > .fill{height:100%;background:var(--accent);width:0}
    .chip{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);padding:4px 8px;border-radius:999px;font-size:12px}
    .chip.error{border-color:var(--error);color:var(--error)}

    /* Meals grid */
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .thumb{aspect-ratio:1/1;border-radius:10px;overflow:hidden;background:var(--border);display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:12px}

    /* Actions */
    .actions{display:flex;gap:12px}
    .btn{flex:1;display:flex;align-items:center;justify-content:center;gap:8px;padding:12px 14px;border-radius:12px;border:2px solid var(--border);background:var(--card);font-weight:600}
    .btn.primary{background:var(--accent);border-color:transparent;color:#111}
    .btn.ghost{background:transparent}

    .kcal-toggle{position:absolute;right:12px;top:12px;font-size:12px;color:var(--muted)}
    .kcal-toggle button{border:1px solid var(--border);background:transparent;padding:4px 8px;border-radius:8px;margin-left:6px}
    .kcal-toggle button.active{background:var(--border)}

    .split{display:flex;align-items:center;justify-content:space-between;margin-top:10px}
  </style>
</head>
<body>
  <div class="phone" role="main">
    <header>
      <div>
        <div class="hi">Ahoj, Jan</div>
        <div class="date" id="todayStr">√öt, 9. z√°≈ô√≠</div>
      </div>
      <button class="icon-btn" aria-label="Menu">‚ãØ</button>
    </header>

    <!-- Today energy -->
    <section class="card" id="card-energy" aria-labelledby="energy-title">
      <div class="row" style="align-items:flex-start">
        <h2 id="energy-title">Dne≈°n√≠ energie</h2>
        <div class="kcal-toggle">zobrazit <button id="tKcal" class="active">kcal</button><button id="tPct">%</button></div>
      </div>
      <div class="donut-wrap">
        <div class="donut" aria-live="polite" aria-label="Kalorick√Ω progres dne">
          <svg width="180" height="180" viewBox="0 0 200 200">
            <circle cx="100" cy="100" r="84" stroke="var(--border)" stroke-width="16" fill="none" stroke-linecap="round"/>
            <circle id="donutProgress" cx="100" cy="100" r="84" stroke="var(--accent)" stroke-width="16" fill="none" stroke-linecap="round" stroke-dasharray="0 999"/>
            <circle id="donutOverflow" cx="100" cy="100" r="84" stroke="var(--error)" stroke-width="6" fill="none" stroke-linecap="round" stroke-dasharray="0 999"/>
          </svg>
          <div class="center">
            <div class="big" id="donutCenter">0 kcal</div>
            <div class="small" id="donutSub">zb√Ωv√°</div>
          </div>
        </div>
        </div>
      <div class="energy-breakdown">
        <div class="item"><span class="muted">Snƒõdeno</span><strong id="consumedStr">0 kcal</strong></div>
        <div class="item"><span class="muted">C√≠l</span><strong id="targetStr">‚Äî</strong></div>
        <div class="item"><span class="muted">Metabolismus</span><strong id="bmrStr">‚Äî</strong></div>
        <div class="item"><span class="muted">Pohyb</span><strong id="activityStr">‚Äî</strong></div>
      </div>
    </section>

    <!-- Protein -->
    <section class="card" aria-labelledby="protein-title">
      <div class="row"><h2 id="protein-title">Protein</h2><a class="sub" href="#" id="editProtein">Nastav c√≠l</a></div>
      <div class="bar" aria-hidden="true"><div class="fill" id="proteinFill"></div></div>
      <div class="split"><span class="muted" id="proteinText">0 g z 0 g</span><span class="chip" id="proteinChip">‚Äî</span></div>
    </section>

    <!-- Steps -->
    <section class="card" aria-labelledby="steps-title">
      <div class="row"><h2 id="steps-title">Kroky</h2><a class="sub" href="#" id="connectSteps">P≈ôipojit Zdrav√≠</a></div>
      <div class="bar" aria-hidden="true"><div class="fill" id="stepsFill"></div></div>
      <div class="split"><span class="muted" id="stepsText">0 z 0</span><span class="chip" id="stepsChip">‚Äî</span></div>
    </section>

    <!-- Meals -->
    <section class="card" aria-labelledby="meals-title">
      <div class="row"><h2 id="meals-title">Posledn√≠ j√≠dla</h2><a class="sub" href="#">P≈ôidat j√≠dlo</a></div>
      <div id="mealsZero" class="muted">Zat√≠m ≈æ√°dn√° j√≠dla ‚Äî P≈ôidej prvn√≠</div>
      <div class="grid" id="mealsGrid" hidden>
        <div class="thumb">foto</div>
        <div class="thumb">foto</div>
        <div class="thumb">foto</div>
        <div class="thumb">foto</div>
      </div>
    </section>

    <!-- Quick actions -->
    <section class="card" aria-labelledby="qa-title">
      <h2 id="qa-title">Rychl√© akce</h2>
      <div class="actions">
        <button class="btn primary">üçΩÔ∏è P≈ôidat j√≠dlo</button>
        <button class="btn">‚öñÔ∏è Zadat v√°hu</button>
        <button class="btn primary">üèÉ‚Äç‚ôÇÔ∏è Zaƒç√≠t tr√©nink</button>
      </div>
    </section>
  </div>

  <script>
    // ------- Demo data (nahraƒè re√°ln√Ωmi vol√°n√≠mi Supabase/RPC) -------
    const data = {
      firstName: 'Jan',
      date: new Date(),
      consumedKcal: 1230,
      targetKcal: 2000,
      bmr: 1650, stepsKcal: 120, workoutKcal: 80,
      proteinToday: 45, proteinTarget: 120,
      stepsToday: 6500, stepsTarget: 8000, baselineSteps: 6000,
      meals: [] // vlo≈æ 1‚Äì4 polo≈æky pro grid
    };

    // ------- Helpers -------
    const fmt = (n) => n.toLocaleString('cs-CZ');
    const el = (id) => document.getElementById(id);

    // Header date
    const d = data.date;
    const dateFmt = new Intl.DateTimeFormat('cs-CZ', {weekday:'short', day:'numeric', month:'short'});
    el('todayStr').textContent = dateFmt.format(d);

    // Donut draw
    const CIRC = 2*Math.PI*84; // r=84
    function drawDonut(consumed, target, unit='kcal'){
      const capped = Math.min(consumed, target);
      const p = target>0 ? capped/target : 0;
      el('donutProgress').setAttribute('stroke-dasharray', `${(p*CIRC).toFixed(1)} ${CIRC}`);
      // overflow
      const over = Math.max(0, consumed - target);
      const overLen = target>0 ? Math.min(over/target, 1) * (CIRC*0.25) : 0; // kr√°tk√Ω oblouk max 25%
      el('donutOverflow').setAttribute('stroke-dasharray', `${overLen.toFixed(1)} ${CIRC}`);

      const remaining = Math.round(target - consumed);
      if(unit==='kcal'){
        el('donutCenter').textContent = `${remaining>=0?'-':''}${fmt(Math.abs(remaining))} kcal`;
        el('donutSub').textContent = remaining>=0? 'zb√Ωv√°' : 'nav√≠c';
      }else{
        const pct = target>0 ? Math.round((consumed/target)*100) : 0;
        const left = Math.max(0, 100-pct);
        el('donutCenter').textContent = `${remaining>=0?left: pct}%`;
        el('donutSub').textContent = remaining>=0? 'zb√Ωv√°' : 'splnƒõno';
      }
      el('consumedStr').textContent = `${fmt(Math.round(consumed))} kcal`;
      el('targetStr').textContent = target>0? `${fmt(Math.round(target))} kcal` : '‚Äî';
      el('bmrStr').textContent = `${fmt(Math.round(data.bmr))} kcal`;
      const move = Math.round((data.stepsKcal||0) + (data.workoutKcal||0));
      el('activityStr').textContent = `${fmt(move)} kcal`;
    }

    // Protein bar
    function setBar(fillEl, pct){ fillEl.style.width = `${Math.max(0,Math.min(100,pct))}%`; }

    function render(){
      drawDonut(data.consumedKcal, data.targetKcal, currentUnit);
      // protein
      const pPct = data.proteinTarget>0 ? data.proteinToday/data.proteinTarget*100 : 0;
      setBar(el('proteinFill'), pPct);
      el('proteinText').textContent = `${fmt(data.proteinToday)} g z ${fmt(data.proteinTarget)} g`;
      const pLeft = Math.round(data.proteinTarget - data.proteinToday);
      el('proteinChip').textContent = pLeft>=0? `${fmt(pLeft)} g zb√Ωv√°` : `+${fmt(Math.abs(pLeft))} g nav√≠c`;
      el('proteinChip').classList.toggle('error', pLeft<0);

      // steps
      const sPct = data.stepsTarget>0 ? data.stepsToday/data.stepsTarget*100 : 0;
      setBar(el('stepsFill'), sPct);
      el('stepsText').textContent = `${fmt(data.stepsToday)} z ${fmt(data.stepsTarget)} krok≈Ø`;
      const sLeft = data.stepsTarget - data.stepsToday;
      el('stepsChip').textContent = sLeft>=0? `${fmt(sLeft)} zb√Ωv√°` : `+${fmt(Math.abs(sLeft))} nav√≠c`;
      el('stepsChip').classList.toggle('error', sLeft<0);

      // meals
      const grid = el('mealsGrid');
      const zero = el('mealsZero');
      if(data.meals.length){
        zero.hidden = true; grid.hidden = false; grid.innerHTML='';
        data.meals.slice(0,4).forEach((m)=>{
          const d=document.createElement('div');d.className='thumb';d.textContent='';
          d.style.backgroundImage=`url(${m})`;d.style.backgroundSize='cover';d.style.backgroundPosition='center';
          grid.appendChild(d);
        });
      }
    }

    // Toggle kcal/%
    let currentUnit='kcal';
    el('tKcal').addEventListener('click',()=>{currentUnit='kcal';el('tKcal').classList.add('active');el('tPct').classList.remove('active');drawDonut(data.consumedKcal,data.targetKcal,currentUnit)});
    el('tPct').addEventListener('click',()=>{currentUnit='%';el('tPct').classList.add('active');el('tKcal').classList.remove('active');drawDonut(data.consumedKcal,data.targetKcal,currentUnit)});

    render();
  </script>
</body>
</html>
